---
- hosts: all
  remote_user: root

  vars:
    bla: blub

  pre_tasks:
    - name: install dependency galaxy role
      delegate_to: localhost
      become: false
      command: ansible-galaxy install geerlingguy.docker --roles-path roles

    - name: Vagrant | Install python dependencies (CentOS7)
      yum:
        name: "{{ item }}"
        state: present
      loop:
        - epel-release
        - python-setuptools
        - python-pip
      when:
        - ansible_os_family|lower == 'redhat'
        - ansible_distribution_version|int <= 7

    - name: Vagrant | Install python dependencies (CentOS8)
      yum:
        name: "{{ item }}"
        state: present
      loop:
        - epel-release
        - python3-pip
      when:
        - ansible_os_family|lower == 'redhat'
        - ansible_distribution_version|int >= 8

    - name: Vagrant | Install python dependencies (Debian/Ubuntu)
      apt:
        name: "{{ item }}"
        state: present
        cache_valid_time: 3600
      loop:
        - python3-pip
      when:
        - ansible_os_family|lower == 'debian'

  tasks:
    # because of pre_task and dependency role, we use include_role: and not
    # role:
    - name: include role to test
      include_role:
        name: ../../ansible-prometheus-kafka-adapter
      vars:
        bla: blub
